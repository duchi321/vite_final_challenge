import{u as O,r as v,i as A,j as B,f as h,c as l,a as t,t as i,d as E,e as I,w as C,v as R,k as c,h as S,n as m,F as x,l as V,b as _,g as X,o as n,m as z}from"./index-DNqIE-N_.js";const F={id:"todoListPage",class:"bg-half"},P={class:"todo_sm"},j={href:"#"},H={class:"conatiner todoListPage vhContainer"},q={class:"todoList_Content"},G={class:"inputBox"},J={class:"todoList_list"},K={class:"todoList_tab"},Q={key:0,class:"todoList_items"},W={class:"todoList_item"},Y=["for"],Z=["id","onUpdate:modelValue","onChange"],tt=["onClick"],et={key:0,class:"todoList_statistics"},st={key:1,class:"todoList_items"},ot={class:"todoList_item"},at=["for"],lt=["id","onUpdate:modelValue","onChange"],nt=["onClick"],it={key:0,class:"todoList_statistics"},dt={key:2,class:"todoList_items"},ut={class:"todoList_item"},rt=["for"],ct=["id","onUpdate:modelValue","onChange"],vt=["onClick"],ht={key:0,class:"todoList_statistics"},p="https://todolist-api.hexschool.io",kt={__name:"TodoView",setup(_t){const N=O(),d=v(""),L=v({nickname:"",uid:""}),k=v(""),g=v([]),u=v(""),r=v("all"),$=o=>{r.value=o},T=A(()=>g.value.filter(o=>o.status===!1)),U=A(()=>g.value.filter(o=>o.status===!0));B(async()=>{const o=document.cookie.replace(/(?:(?:^|.*;\s*)cookiesSaveToken\s*=\s*([^;]*).*$)|^.*$/,"$1");if(d.value=o,!d.value){N.push("/login");return}try{const s=await h.get(`${p}/users/checkout`,{headers:{Authorization:d.value}});L.value=s.data,y()}catch{console.log("未登入")}});const D=async()=>{if(L.value.uid===""){alert("未登入");return}try{await h.post(`${p}/users/sign_out`,{},{headers:{Authorization:d.value}}),alert("成功登出"),N.push("/")}catch(o){alert("登出錯誤: "+o.message)}},y=async()=>{try{const o=await h.get(`${p}/todos/`,{headers:{Authorization:d.value}});o.data.status&&(o.data.data.length===0?(u.value="目前尚無待辦事項",g.value=o.data.data):(u.value="",o.data.data.forEach(s=>{const f=s.createTime,a=new Date(f*1e3).toISOString().slice(0,19).replace("T"," ");s.createTime=a}),g.value=o.data.data))}catch(o){console.log(o)}},M=async()=>{try{k.value?(await h.post(`${p}/todos/`,{content:k.value},{headers:{Authorization:d.value}}),k.value="",y()):alert("沒有填寫代辦事項")}catch(o){console.log(o)}},w=async(o,s)=>{try{await h.patch(`${p}/todos/${o}/toggle`,{status:s},{headers:{Authorization:d.value}}),y()}catch(f){console.log(f)}},b=async o=>{try{await h.delete(`${p}/todos/${o}`,{headers:{Authorization:d.value}}),y()}catch(s){console.log(s)}};return(o,s)=>{const f=X("RouterLink");return n(),l("div",F,[t("nav",null,[s[5]||(s[5]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",P,[t("a",j,[t("span",null,"Hello There "+i(L.value.nickname)+"!",1)]),E(f,{to:"",onClick:D},{default:I(()=>s[4]||(s[4]=[S("登出")])),_:1})])])]),t("div",H,[t("div",q,[t("div",G,[C(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[0]||(s[0]=e=>k.value=e)},null,512),[[R,k.value]]),t("a",{href:"",onClick:c(M,["prevent"])},s[6]||(s[6]=[t("i",{class:"fa fa-plus"},null,-1),S("+ ")]))]),t("div",J,[t("ul",K,[t("li",null,[t("a",{href:"#",class:m({active:r.value==="all"}),onClick:s[1]||(s[1]=c(e=>$("all"),["prevent"]))},"全部",2)]),t("li",null,[t("a",{href:"#",class:m({active:r.value==="notyet"}),onClick:s[2]||(s[2]=c(e=>$("notyet"),["prevent"]))},"待完成",2)]),t("li",null,[t("a",{href:"#",class:m({active:r.value==="theend"}),onClick:s[3]||(s[3]=c(e=>$("theend"),["prevent"]))},"已完成",2)])]),r.value==="all"?(n(),l("div",Q,[t("ul",W,[(n(!0),l(x,null,V(g.value,e=>(n(),l("li",{key:e.id},[t("label",{class:"todoList_label",for:e.id},[C(t("input",{class:"todoList_input",type:"checkbox",value:"true",id:e.id,"onUpdate:modelValue":a=>e.status=a,onChange:a=>w(e.id)},null,40,Z),[[z,e.status]]),t("span",null,i(e.content),1)],8,Y),t("a",{href:"",onClick:c(a=>b(e.id),["prevent"])},s[7]||(s[7]=[t("i",{class:"delstyle"},"X",-1)]),8,tt)]))),128))]),t("p",null,i(u.value),1),u.value?_("",!0):(n(),l("div",et,[t("p",null,i(T.value.length)+" 個待完成項目",1)]))])):_("",!0),r.value==="notyet"?(n(),l("div",st,[t("ul",ot,[(n(!0),l(x,null,V(T.value,e=>(n(),l("li",{key:e.id},[t("label",{class:"todoList_label",for:e.id},[C(t("input",{class:"todoList_input",type:"checkbox",value:"true",id:e.id,"onUpdate:modelValue":a=>e.status=a,onChange:a=>w(e.id)},null,40,lt),[[z,e.status]]),t("span",null,i(e.content),1)],8,at),t("a",{href:"",onClick:c(a=>b(e.id),["prevent"])},s[8]||(s[8]=[t("i",{class:"delstyle"},"X",-1)]),8,nt)]))),128))]),t("p",null,i(u.value),1),u.value?_("",!0):(n(),l("div",it,[t("p",null,i(T.value.length)+" 個待完成項目",1)]))])):_("",!0),r.value==="theend"?(n(),l("div",dt,[t("ul",ut,[(n(!0),l(x,null,V(U.value,e=>(n(),l("li",{key:e.id},[t("label",{class:"todoList_label",for:e.id},[C(t("input",{class:"todoList_input",type:"checkbox",value:"true",id:e.id,"onUpdate:modelValue":a=>e.status=a,onChange:a=>w(e.id)},null,40,ct),[[z,e.status]]),t("span",null,i(e.content),1)],8,rt),t("a",{href:"",onClick:c(a=>b(e.id),["prevent"])},s[9]||(s[9]=[t("i",{class:"delstyle"},"X",-1)]),8,vt)]))),128))]),t("p",null,i(u.value),1),u.value?_("",!0):(n(),l("div",ht,[t("p",null,i(U.value.length)+" 個已完成項目",1)]))])):_("",!0)])])])])}}};export{kt as default};
